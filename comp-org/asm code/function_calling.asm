To craft a message that balances both your gratitude for Felipe's support and a request for a referral, while avoiding the impression that you're only reaching out for personal gain, you can follow these steps. Here's how you can structure the conversation:

### Initial Reach-Out:
1. **Greeting and Check-in:** Start by catching up briefly and expressing genuine interest in Felipe's current life or work.
   
   **Message:**
   > *Hey Felipe! It's been a while, hope you're doing well! How have things been at Microsoft lately?*

2. **Mutual Interests/Connection:** Refer back to something you discussed in the past (like ShellHacks or your journey in Leetcode) to maintain a friendly, conversational tone.

   **Message:**
   > *Since last year, I've taken up on your advice and have been grinding away at Leetcode and just finished my 355th! Thanks to you, I also joined my school's ICPC team and made it to the Regionals in Div 2, but I'm shooting for Div 1 this year too!*

3. **Progress Update:** Share your progress, such as the number of problems solved, and perhaps mention how ICPC was a valuable learning experience. This shows your dedication and growth.

   **Message:**
   > *I was doing an AI internship over the summer, and it was super cool to experience what the SWE culture is all about first hand. I've also managed to do a bunch more side projects to start my vengeance arc at Shellhacks this year as well :D*

4. **Referral Request:** Transition into the request for a referral, positioning it as an invitation for feedback or validation rather than solely asking for a favor. This way, it feels collaborative rather than transactional.

   **Message:**
   > *I’ve been doing my research on roles at Microsoft, and I think I’m finally at a point where I could take a shot at it. I’d love to get your thoughts on my progress so far and, if you think it’s appropriate, maybe even a referral? I can send over my resume and project portfolio for you to check out first, if that helps!*

5. **Closing:** End with an open-ended, friendly note.

   **Message:**
   > *No pressure at all, I really appreciate any advice or help you can offer. And thank you again for all your support along the way!*

This approach shows that you value his input and are genuinely interested in feedback. It keeps the conversation collaborative and avoids the impression that you're just asking for something.